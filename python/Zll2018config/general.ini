#! ------------------------
#!! GENERAL CONFIGURATION
#!! -------------------------

[General]
electronMVA = <!General|electronMVA90!>
preselectionCut = 1
#Htype = REG
Htype = KINFIT

[SubmitOptions]
submitScriptSpecialOptions = {'run': ' -l h_vmem=3g'}

[Configuration]
# NanoAOD format
treeName = Events
#countTreeName = genEventSumw_ 
#for NanoAODv7
#countTreeName = genWtHist
AllowDuplicateTrees = True
countsFromAutoPU = False

[Prep]
Step1           = ['VHbbCommon.Clean','VHbbCommon.JetSmearer','VHbbCommon.JECcorrelator','VHbbCommon.LeptonSelection']
Step2           = ['VHbbCommon.METXY','VHbbCommon.mSD_scale_res_shift','VHbbCommon.Selection', 'VHbbCommon.isData', 'VHbbCommon.isSignal','VHbbCommon.isWH','VHbbCommon.isZH','VHbbCommon.HeppyStyleGen','VHbbCommon.genBstatus']

[Sys]
useTreeFriends = False

#test = ['VHbbCommon.EFT_obs','VHbbCommon.EFT_params']
test = ['VHbbCommon.EFT_obs','VHbbCommon.EFT_interpolation']

all = ['VHbbCommon.BTagSF','VHbbCommon.electronSF','VHbbCommon.muonSF','VHbbCommon.HiggsReco','VHbbCommon.vLeptons','VHbbCommon.EWKweights','VHbbCommon.DYspecialWeight', 'VHbbCommon.LOtoNLOweight','VHbbCommon.JetPUIDSF','VHbbCommon.SampleGroup','VHbbCommon.DoubleBtagSF']


all2 = ['VHbbCommon.isBoosted','VHbbCommon.isBoostedVZ']

#all = ['VHbbCommon.SampleGroup','VHbbCommon.BTagSFDeepCSV','Sys.electronSFrun2','Sys.muonSF','Sys.Run2017BmuHLT','VHbbCommon.HiggsReco','VHbbCommon.vLeptons','VHbbCommon.EWKweights','VHbbCommon.DYspecialWeight', 'VHbbCommon.LOtoNLOweight','VHbbCommon.JetPUIDSF','VHbbCommon.DoubleBtagSF']

#boostedFlags = ['VHbbCommon.isBoosted','VHbbCommon.isBoostedVZ']


# weights
muonSF = MuonSFfromJSON.MuonSFfromJSON(jsonFiles=['/work/krgedia/CMSSW_10_1_0/src/Xbb/python/data/Zll/Muons/RunABCD2018_SF_ID.json','/work/krgedia/CMSSW_10_1_0/src/Xbb/python/data/Zll/Muons/RunABCD2018_SF_ISO.json','/work/krgedia/CMSSW_10_1_0/src/Xbb/python/data/Zll/Muons/Eff_IsoMu8Cut_NUM_IsoMu8leg_DEN_LooseRelIso_PAR_newpt_etaMC2018.json','/work/krgedia/CMSSW_10_1_0/src/Xbb/python/data/Zll/Muons/Eff_IsoMu17Cut_NUM_IsoMu17leg_DEN_LooseRelIso_PAR_newpt_etaMC2018.json','/work/krgedia/CMSSW_10_1_0/src/Xbb/python/data/Zll/Muons/Eff_IsoMu8Cut_NUM_IsoMu8leg_DEN_LooseRelIso_PAR_newpt_eta_DATA2018.json','/work/krgedia/CMSSW_10_1_0/src/Xbb/python/data/Zll/Muons/Eff_IsoMu17Cut_NUM_IsoMu17leg_DEN_LooseRelIso_PAR_newpt_eta_DATA2018.json'], channel='Zll',year=2018)
electronSF = ElectronSFfromJSON.ElectronSFfromJSON(jsonFiles=['/work/krgedia/CMSSW_10_1_0/src/Xbb/python/data/Zll/Electrons/IDs2018passingMVA94Xwp90iso.json','/work/krgedia/CMSSW_10_1_0/src/Xbb/python/data/Zll/Electrons/Trig2018passingDoubleEleLeg1.json','/work/krgedia/CMSSW_10_1_0/src/Xbb/python/data/Zll/Electrons/Trig2018passingDoubleEleLeg2.json','data/Wlv/Electrons/ScaleFactor_etracker_80x.json'], branchName='electronSF', channel='Zll', year=2018)

PUweight = PUweight.PUweight(fileNameData='/work/krgedia/CMSSW_10_1_0/src/Xbb/python/data/pu/2018/PileupHistogram-goldenJSON-13tev-2018-69200ub-100bins.root',fileNameMC='/work/krgedia/CMSSW_10_1_0/src/Xbb/python/data/pu/2018/mc_pu.root',fileNameDataUp='/work/krgedia/CMSSW_10_1_0/src/Xbb/python/data/pu/2018/PileupHistogram-goldenJSON-13tev-2018-72400ub-100bins.root',fileNameDataDown='/work/krgedia/CMSSW_10_1_0/src/Xbb/python/data/pu/2018/PileupHistogram-goldenJSON-13tev-2018-66000ub-100bins.root',puWeightName='puWeight')

# PU weight is now already present!
#PUweight = PUweight.PUweight(fileNameData='data/pu/2017/PU_Cert_294927-306462_13TeV_PromptReco_Collisions17_JSON.root',fileNameMC=None,fileNameDataUp='data/pu/2017/PU_Cert_294927-306462_13TeV_PromptReco_Collisions17_JSON_Up.root',fileNameDataDown='data/pu/2017/PU_Cert_294927-306462_13TeV_PromptReco_Collisions17_JSON_Down.root',puWeightName='puWeightAuto')
GetDoubleMuTriggWeight = GetDoubleMuTriggWeight.GetDoubleMuTriggWeight()
aJidx = aJidx.aJidx()

# clean-up
DropFatJet = Drop.Drop(dropBranches=['FatJet_*','nFatJet'])
DropTau = Drop.Drop(dropBranches=['Tau_*','nTau','nGenVisTau','GenVisTau_*'])
DropPhoton = Drop.Drop(dropBranches=['Photon_*','nPhoton'])
DropSubJet = Drop.Drop(dropBranches=['SubJet_*','nSubJet'])
DropTrigObj = Drop.Drop(dropBranches=['TrigObj_*','nTrigObj'])
DropMETsys = Drop.Drop(dropBranches=['MET_pt_j*','MET_phi_j*'])
DropUnusedHLT = Drop.Drop(dropBranches=['HLT_*'],keepBranches=['HLT_Ele23_Ele12_CaloIdL_TrackIdL_Iso*','HLT_Mu17_TrkIsoVVL_Mu8_TrkIsoVVL_DZ_Mass*'])
Run2017BmuHLT = BranchTools.DefaultIfNotExisting(branchName='HLT_Mu17_TrkIsoVVL_Mu8_TrkIsoVVL_DZ_Mass3p8',branchType='O',defaultValue=0)
Selection2017V2JERfix = Selection2017V2JERfix.Selection2017V2JERfix()


[Branches]
;branch that should always be kept in the Nutples
keep_branches = ['is*', 'run', 'event', 'luminosityBlock', 'sampleIndex', 'genWeight', 'puWeight', 'V_*','EWKwVJets', 'LHE_*', 'Vtype', 'vLidx', 'HLT_Mu17_TrkIsoVVL_Mu8_TrkIsoVVL_DZ_Mass*', 'HLT_Ele23_Ele12_CaloIdL_TrackIdL_Iso*', 'GenJet_pt', 'GenJet_eta', 'GenJet_hadronFlavour', 'genWeight','electronSF','muonSF','bTagWeightDeepCSV*','Pileup_nTrueInt', 'fixedGridRhoFastjetAll','*BDT*','puWeightDown','puWeightUp','btagWeight_DeepCSVB','nGenStatus2bHad','GenPart*','DY_specialWeight','weightLO*','nFSRrecovered','Jet_lepFilter','weight*', 'EFT_obs*', 'EFT_interpolation*']

keep_branches_plot = []

